$        = require('gulp-load-plugins')()
gulp     = require 'gulp'
config   = require './config.json'
babelify = require 'babelify'



gulp.task 'scripts', ->
  gulp.src('./src/app.jsx')
    .pipe($.plumber())
    .pipe($.browserify(
      transform: [
        [babelify, {presets:  ["es2015", "react"]}]
      ]
      extensions: '.jsx'
    ))
    .pipe($.debug())
    .pipe($.rename('app.js'))
    .pipe(gulp.dest('./app'))
    .pipe($.livereload())


gulp.task 'server', ->
  gulp.src('app')
    .pipe($.serverLivereload(
      host: config.server.host
      port: config.server.port
      livereload: on
    ))


gulp.task 'watch', ->
  $.livereload.listen(
    quiet: on
  )
  $.watch('./src/**/*.jsx', $.batch (cb) ->
    gulp.start('scripts')
    cb()
  )


gulp.task 'serve', [
  'scripts'
  'server'
  'watch'
]

gulp.task 'default', ['serve']